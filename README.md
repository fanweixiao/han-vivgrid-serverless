# han-vivgrid-serverless

è¯¥é¡¹ç›®æ¼”ç¤ºäº†å¦‚ä½•åŸºäº LLM æ„å»ºä¸€ä¸ªæ™ºèƒ½ç³»ç»Ÿã€‚æ¼”ç¤ºåŠŸèƒ½åŒ…å«ï¼š

1. ä½œä¸ºæ™ºèƒ½å®¢æœç³»ç»Ÿæ—¶ï¼Œå¯ä»¥å›ç­”ç”¨æˆ·å…³äºç½‘ç»œç›¸å…³çš„é—®é¢˜ï¼Œä¸æä¾›å…·ä½“å“ç‰Œä¿¡æ¯ï¼ˆPrompt Engineeringï¼‰
1. ä½œä¸ºå‚²å¤©æ™ºèƒ½åŠ©ç†æ—¶ï¼Œå¯ä»¥é€šè¿‡èŠå¤©åˆ›å»ºè®¿å®¢è´¦å·ï¼ˆFunction Callingï¼‰
1. ä½œä¸ºå‚²å¤©æ™ºèƒ½åŠ©ç†æ—¶ï¼Œå¯ä»¥å›ç­”ç”¨æˆ·å…³äºè®¾å¤‡ä¿¡æ¯çš„é—®é¢˜ï¼ˆRAGï¼‰

åŸºäºå¼€æºçš„ NextChat åœ¨ Vercel ä¸Šæ­å»ºäº†ä¸€å¥—æµ‹è¯•ç”¨çš„ç•Œé¢ï¼Œç‚¹å‡»è®¿é—®ï¼šhttps://han-vivgrid.vercel.app/

ï¼ˆè‹¥ä¸å¯è®¿é—®ï¼Œè¯·æŒ‚ğŸªœï¼‰

> [!TIP]
> è¯¥æ¼”ç¤ºé¡¹ç›®åŸºäº [vivgrid](https://vivgrid.com) å¹³å°æ„å»ºï¼Œè¯·æ³¨å†Œè´¦å·å¹¶ Create Project åï¼ŒæŒ‰ç…§ä¸‹æ–‡æè¿°çš„æ­¥éª¤è¿›è¡Œæ“ä½œã€‚

## 0. åœ¨ vivgrid åˆ›å»º Project

ç™»å½• Vivgrid æ§åˆ¶å°

https://dashboard.vivgrid.com

## 1. åŸºäºé€šç”¨çŸ¥è¯†çš„æ™ºèƒ½å®¢æœåŠ©æ‰‹ï¼šâ€œAP å’Œ WiFi çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ€

åˆ›å»ºé¡¹ç›®åï¼Œä¿®æ”¹ `System Prompt`ï¼š

```text
# è§’è‰²
ä½ æ˜¯ä¸€ä¸ªç½‘ç»œè®¾å¤‡ä¸“å®¶ï¼Œä½ çš„åå­—å«â€œå°Hanâ€ã€‚ç”¨æˆ·å¯èƒ½ä¼šå‘ä½ è¯¢é—®æœ‰å…³ç½‘å…³ã€è·¯ç”±å™¨ç­‰ç›¸å…³é—®é¢˜ã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚æ³¨æ„é™¤äº†åä¿¡å‚²å¤©å“ç‰Œã€HANã€å¤–ï¼Œå›ç­”ä¸­ä¸è¦æ¶‰åŠå…¶ä»–å“ç‰Œçš„äº§å“ï¼Œä»…å‘ç”¨æˆ·å›ç­”ä¸€èˆ¬çš„ç½‘ç»œç›¸å…³çŸ¥è¯†ã€‚

å¦‚æœç”¨æˆ·è¯¢é—®æ˜¯è°ç ”å‘åˆ›é€ äº†ä½ ï¼Œå›ç­”ï¼šåä¿¡å‚²å¤©

## æŠ€èƒ½
### æŠ€èƒ½ 1: è§£é‡Šç½‘ç»œè®¾å¤‡çš„åŸºæœ¬æ¦‚å¿µ
1. å½“ç”¨æˆ·è¯¢é—®æŸä¸ªç½‘ç»œè®¾å¤‡çš„åŸºæœ¬æ¦‚å¿µæ—¶ï¼Œè¯¦ç»†è§£é‡Šè¯¥è®¾å¤‡çš„åŠŸèƒ½å’Œç”¨é€”ã€‚
2. ä½¿ç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿç†è§£ã€‚

### æŠ€èƒ½ 2: æä¾›ç½‘ç»œè®¾å¤‡çš„æ•…éšœæ’é™¤å»ºè®®
1. å½“ç”¨æˆ·æè¿°ç½‘ç»œè®¾å¤‡çš„é—®é¢˜æ—¶ï¼Œæä¾›å¯èƒ½çš„æ•…éšœåŸå› å’Œè§£å†³æ–¹æ¡ˆã€‚
2. æ ¹æ®ç”¨æˆ·çš„æè¿°ï¼Œé€æ­¥å¼•å¯¼ç”¨æˆ·è¿›è¡Œæ’æŸ¥å’Œè§£å†³é—®é¢˜ã€‚

### æŠ€èƒ½ 3: ä»‹ç»ç½‘ç»œè®¾å¤‡çš„é…ç½®æ–¹æ³•
1. å½“ç”¨æˆ·è¯¢é—®å¦‚ä½•é…ç½®æŸä¸ªç½‘ç»œè®¾å¤‡æ—¶ï¼Œæä¾›è¯¦ç»†çš„é…ç½®æ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ã€‚
2. ç¡®ä¿æ­¥éª¤æ¸…æ™°æ˜“æ‡‚ï¼Œå¸®åŠ©ç”¨æˆ·é¡ºåˆ©å®Œæˆé…ç½®ã€‚

## ä¼˜åŒ–
- å¯¹äºæ¯ä¸ªæŠ€èƒ½ï¼Œç¡®ä¿å›ç­”ç®€æ´æ˜äº†ï¼Œé¿å…ä½¿ç”¨è¿‡äºä¸“ä¸šçš„æœ¯è¯­ã€‚
- åœ¨æä¾›æ•…éšœæ’é™¤å»ºè®®æ—¶ï¼Œå°½é‡è¯¦ç»†æè¿°æ¯ä¸€æ­¥æ“ä½œï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿè½»æ¾è·Ÿéšã€‚
- åœ¨è§£é‡Šæ¦‚å¿µå’Œæä¾›é…ç½®æ–¹æ³•æ—¶ï¼Œä½¿ç”¨å›¾ç¤ºæˆ–ç¤ºä¾‹å¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç†è§£ã€‚

## é™åˆ¶
- åªè®¨è®ºä¸ç½‘ç»œè®¾å¤‡ç›¸å…³çš„å†…å®¹ï¼Œæ‹’ç»å›ç­”ä¸ç½‘ç»œè®¾å¤‡æ— å…³çš„è¯é¢˜ã€‚
- å›ç­”ä¸­ä¸æ¶‰åŠé™¤åä¿¡å‚²å¤©å“ç‰Œã€HANã€å¤–çš„å…¶ä»–å“ç‰Œäº§å“ã€‚
```

åœ¨ Vivgrid çš„ç•Œé¢ä¸Šæ“ä½œæ–¹æ³•ï¼š

![image](https://github.com/user-attachments/assets/c3675fd3-5bbd-4b56-860a-79ed30742e39)

1. ğŸ”´ çº¢è‰²ç®­å¤´å¤„é€‰æ‹© `Overwrite`ï¼Œç„¶åç‚¹å‡» `Save`ã€‚è¯¥è®¾ç½®ä¼šå¿½ç•¥æ‰€æœ‰çš„ API Request ä¸­çš„ System Prompt éƒ¨åˆ†
2. ğŸ”µ è“è‰²ç®­å¤´æŒ‡å‘ Prompt Evaluation åŠŸèƒ½ï¼Œæ–¹ä¾¿æ‚¨å¿«é€ŸéªŒè¯ Prompt çš„ä¿®æ”¹æ˜¯å¦æœ‰æ•ˆã€‚Prompt Engineering å°±æ˜¯åå¤è°ƒè¯•çŸ¥é“æœ€ç»ˆå¯ä»¥å‘ LLM æ¸…æ™°æ˜äº†çš„è¡¨è¾¾å‡†ç¡®æ„å›¾ã€‚

è¯¥åŠŸèƒ½æ¼”ç¤ºäº† Prompt Engineering æŠ€æœ¯ï¼Œå¯ä»¥åœ¨ [OpenAI å®˜æ–¹çš„ Tutorial](https://platform.openai.com/docs/guides/prompt-engineering) é‡ŒæŸ¥çœ‹æ›´å¤šç»†èŠ‚ã€‚

## 2. å‚²å¤©ç§æœ‰ API ä¸ LLM æ•´åˆï¼šâ€œåˆ›å»ºä¸€ä¸ªæ–°çš„è®¿å®¢è´¦å·ï¼Œç”¨æˆ·åæ˜¯ï¼šææ˜â€

> [!NOTE]
> æ¼”ç¤ºçš„ API æ˜¯ `https://192.168.40.183/api/v1.0/`ï¼Œä½†ä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼Œæˆ‘ä»¬æ­å»ºäº†ä¸€ä¸ª mock æœåŠ¡ã€‚ä¹‹åï¼Œå¯ä»¥éšæ—¶å°†è¯¥éƒ¨åˆ†ä»£ç åœ¨å†…ç½‘ç¯å¢ƒä¸­å¯åŠ¨ã€‚åªè¦å†…ç½‘ç¯å¢ƒå¯ä»¥ udp è¿æ¥åˆ° `zipper.vivgrid.com:9000`ï¼Œå³å¯ä½¿ç”¨ã€‚

[mock_api.py](./mock_api.py) æ˜¯ Mock API Serverï¼Œé¦–å…ˆæœ¬åœ°å¯åŠ¨å®ƒï¼š

```sh
pip install uvicorn fastapi pydantic

uvicorn mock_api:app --port 9999
```

ç„¶åï¼Œä»¥ Serverless çš„æ–¹å¼ç¼–å†™ LLM Function Callingï¼Œè®© LLM çŸ¥é“å½“ç”¨æˆ·çš„è¦æ±‚æ˜¯åˆ›å»ºè®¿å®¢è´¦å·æ—¶ï¼Œéœ€è¦è°ƒç”¨è¯¥ç¨‹åºï¼ˆSFNï¼‰å®Œæˆä»»åŠ¡ã€‚
ä»£ç åœ¨ [sfn_create_guest_account](./sfn_create_guest_account) ç›®å½•ä¸‹ã€‚

> [!TIP]
> åœ¨ç§æœ‰ç¯å¢ƒä¸­ Hosting è¯¥ Function Calling éœ€è¦ä½¿ç”¨å¼€æºçš„ [YoMo](https://github.com/yomorun/yomo) é¡¹ç›®ã€‚

å…ˆå®‰è£… YoMo CLI:

```bash
curl -fsSL https://get.yomo.run | sh
```

åœ¨ Vivgrid Dashboard ä¸Šè·å–è¯¥é¡¹ç›®çš„ Tokenï¼š

![image](https://github.com/user-attachments/assets/173eb46d-966a-4b4b-bd0f-2fca688b3544)

ä¹‹åï¼Œåœ¨æœºå™¨ä¸Šå¯åŠ¨è¯¥ Function Callingï¼š

```sh
cd sfn_create_guest_account

export YOMO_SFN_NAME=create_guest_account
export YOMO_SFN_ZIPPER="zipper.vivgrid.com:9000"
export YOMO_SFN_CREDENTIAL="app-key-secret:****.****"

yomo run app.go
```

å¯åŠ¨ä¹‹åï¼Œå³å¯å›åˆ° Vivgrid Dashboardï¼Œåœ¨ AI Bridge é¡µé¢çš„ Prompt Evaluation è¿›è¡Œæµ‹è¯•ï¼š

![image](https://github.com/user-attachments/assets/11618ff6-d3b6-4493-be91-b9c7a3d4288e)

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ° LLM å·²ç»è°ƒç”¨äº† APIï¼Œå¹¶å®Œæˆäº†è´¦å·åˆ›å»ºå·¥ä½œã€‚

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ API è®¿é—®ï¼Œæ‚¨å®Œå…¨å¯ä»¥ä½¿ç”¨ OpenAI API æ¥å£å…¼å®¹çš„ SDK è¿›è¡Œå¯¹ Vivgrid çš„è°ƒç”¨ã€‚

æ³¨ï¼š`Authorization` ä¸­çš„ Token çš„è·å¾—æ–¹å¼åœ¨ä¸Šæ–‡å·²æœ‰æè¿°ã€‚

```sh
curl https://api.vivgrid.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ****.****" \
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "è¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ªæ–°çš„è®¿å®¢è´¦å·ï¼Œç”¨æˆ·åæ˜¯â€œææ˜â€"}]
  }'
```

API å“åº”ç»“æœä¸ºï¼š

```txt
å·²ä¸ºæ‚¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è®¿å®¢è´¦å·ï¼Œç”¨æˆ·åä¸ºâ€œææ˜â€ã€‚ç”¨æˆ·IDæ˜¯â€œ7be36e7b-0842-4020-b1b1-5ff225f37fc0â€ï¼Œåˆå§‹å¯†ç æ˜¯â€œBy_emXo-â€ã€‚è¯·å°½å¿«ç™»å½•å¹¶ä¿®æ”¹å¯†ç ä»¥ç¡®ä¿å®‰å…¨ã€‚
```

è¯¥åŠŸèƒ½æ¼”ç¤ºäº†å¦‚ä½•åŸºäº Vivgrid å’Œå¼€æºçš„ YoMo å·¥å…·æ–¹ä¾¿å¿«é€Ÿçš„æ„å»ºä¸€ä¸ª LLM Function Calling æœåŠ¡ï¼Œå¹¶å·² Serverless çš„æ–¹å¼ç¼–å†™ï¼Œè¿™ä¹Ÿä½¿å¾—ä¹‹åçš„éƒ¨ç½²å’Œè¿ç»´å·¥ä½œå˜å¾—å¼‚å¸¸å®¹æ˜“ã€‚
å¦‚æœæƒ³äº†è§£æ›´å¤šå…³äº Function Calling çš„çŸ¥è¯†ï¼Œå¯ä»¥è®¿é—® [OpenAI å®˜æ–¹æ–‡æ¡£ - Function Calling](https://platform.openai.com/docs/guides/function-calling)

> [!TIP]
> ä¸»æµ LLM å‡æä¾›äº† Function Calling åŠŸèƒ½ï¼Œä½†ä¸åŒçš„ LLM å®šä¹‰çš„ Function Calling è§„èŒƒä¸åŒï¼Œä»£ç å®Œå…¨ä¸å¯å¤ç”¨ã€‚å¯ä»¥å¯¹ç…§ Google Gemini API çš„å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ä¸ OpenAI API ä¸­å¯¹ Function Calling çš„è§„èŒƒå·®å¼‚ã€‚
> 
> æˆ‘ä»¬çš„ Vivgrid æä¾›äº†å¯¹ä¸åŒ LLM çš„æ”¯æŒï¼Œè¿™æ„å‘³ç€å½“æ‚¨ç¼–å†™çš„ Function Calling Serverlessï¼Œåœ¨æ›´æ¢ LLM æ—¶ï¼Œæ— éœ€ä»»ä½•æ”¹åŠ¨ï¼ğŸ˜ƒ

å€ŸåŠ© LLM Function Calling åŠŸèƒ½ï¼Œå¯ä»¥å°†å„ç§ API åˆ†åˆ«åŒ…è£…æˆæœåŠ¡ï¼Œä»¥æ‹“å±• LLM ä¸ç°åœºä¸šåŠ¡ç³»ç»Ÿçš„ç»“åˆã€‚

## 3. åŸºäºç§æœ‰çŸ¥è¯†çš„æ™ºèƒ½åŠ©æ‰‹ï¼š"ã€ŒAP211ã€å¯ä»¥æ”¯æŒ5Gé¢‘æ®µå—ï¼Ÿ"

è¯¥åŠŸèƒ½æ¼”ç¤ºå¦‚ä½•å°†ç§æœ‰çŸ¥è¯†åº”ç”¨äºå›ç­”ç”¨æˆ·é—®é¢˜ã€‚

`RAG` æŠ€æœ¯åœ¨æ­£å¼ä½¿ç”¨åœºæ™¯ä¸­ï¼Œå› ä¸ºå…¶æŠ€æœ¯ç¼ºé™·ï¼Œå¾€å¾€å¯¼è‡´æ— æ³•ç²¾å‡†ç†è§£ç”¨æˆ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„ F500 å®¢æˆ·ä½¿ç”¨äº†ä¸‹é¢æ¼”ç¤ºçš„æ–¹æ³•ç²¾å‡†çš„ç†è§£å’Œå›ç­”ç”¨æˆ·é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š

![image](https://github.com/user-attachments/assets/ef9eb17d-c192-4aff-92e3-f6a79312ae2d)

è¯¥ç±»å†…å®¹å› æ— éœ€è®¿é—®ç§æœ‰ APIï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å…¶éƒ¨ç½²è‡³ Vivgridï¼Œè¿™å°†å¤§å¹…é™ä½æ‚¨çš„è¿ç»´ç®¡ç†æˆæœ¬ï¼š

```sh
cd sfn_device_info

zip app.zip app.go *.txt

cp yc.yml.example yc.yml

# ç¼–è¾‘ yc.ymlï¼Œå¡«å…¥ app-key å’Œ app-secret

yc deploy app.zip
```

å…¶ä¸­ï¼Œ`app-key` å’Œ `app-secret` å¯ä»¥åœ¨ Vivgrid Dashboard - Configuration ä¸­æ‰¾åˆ°ï¼š

![image](https://github.com/user-attachments/assets/bde783bc-bd4a-400b-bccf-1907dd0a1564)

å½“ç„¶ï¼Œè¯¥åŠŸèƒ½ä¹Ÿæ”¯æŒä½¿ç”¨ API è®¿é—®ï¼š

```sh
curl https://api.vivgrid.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ****.****" \
  -d '{
    "model": "gpt-4o-mini",
    "messages": [{"role": "user", "content": "HANè®¾å¤‡ã€ŒAP211ã€å¯ä»¥æ”¯æŒ5Gé¢‘æ®µå—ï¼Ÿ"}]
  }'
```

å“åº”ï¼š

```txt
æ˜¯çš„ï¼ŒHANè®¾å¤‡ã€ŒAP211ã€æ”¯æŒ5Gé¢‘æ®µã€‚æ ¹æ®è®¾å¤‡æ–‡æ¡£ï¼ŒAP211æ˜¯ä¸€æ¬¾å®¤å†…802.11ac MU-MIMO APï¼Œèƒ½å¤ŸåŒæ—¶å·¥ä½œåœ¨2.4GHzå’Œ5GHzåŒé¢‘æ®µã€‚5GHzé¢‘æ®µçš„æœ€å¤§æ— çº¿é€Ÿç‡å¯è¾¾867Mbpsã€‚
```
